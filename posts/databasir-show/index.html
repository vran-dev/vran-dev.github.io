<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

		
		<meta name="google-site-verification" content="WQzn_X1rrhY2HHCuTYlY750m0YcuY3H73Z3T-OFsDOM" />
        

		<meta name="author" content="vran">
		
		<meta name="generator" content="Hugo 0.106.0">
		<title>也许是市面上最强的数据库文档管理工具了吧！ &middot; 且徐行</title>
		<link rel="shortcut icon" href="https://blog.cc1234.cc/images/favicon.ico">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/style.css">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/highlight.css">
</head>


<body>
    <section id="single" class="wrapper">
    <nav class="nav-main" style="display: flex;">
         <div style="margin-left:auto;">
            
            <a href='https://blog.cc1234.cc/'> Home</a>
            <a href='https://blog.cc1234.cc/posts'>Archive</a> 
            <a href='https://blog.cc1234.cc/tags'>Tags</a> 
            <a href='https://blog.cc1234.cc/about'>About</a>
   
           
         </div>
</nav>

        <article class = "post">
            <header>
                <div class = "post-img">
                    <img src='img/databasir.png' alt="" />
                </div>
                <div class = "title" >
                    也许是市面上最强的数据库文档管理工具了吧！
                </div>
                <div class="meta">
                2022/03/24
                · vran
                </div>
            </header>
            <div class = "line"></div>
            
            <section class="content">
                <h2 id="背景">背景</h2>
<p>在软件行业，API 文档的自动化有着非常广泛而成熟的方案，但数据库模型文档的自动化却还是一片蓝海，我曾在网上搜寻良久，但并没有找到一款能同时满足我以下需求点的产品</p>
<ol>
<li><strong>自动化</strong>：基于数据库自动生成文档</li>
<li><strong>版本化</strong>：文档历史版本回溯，版本差异对比</li>
<li><strong>团队化</strong>：适应不同团队结构，多样性功能为跨团队协作赋能</li>
<li><strong>个性化</strong>：给予使用者一定的文档定制能力</li>
</ol>
<p>鉴于此，我利用业余的时间开发并开源了  <a href="https://github.com/vran-dev/databasir"><img src="img/databasir.png" alt=""></a> 这个项目，它专注于数据库文档的管理，核心能力就是上面提到的自动化、版本化、团队化和个性化四点。</p>
<p>如题，如果有更好的产品欢迎留言指出，给我一个奋斗的目标，当然这里也别忘点赞收藏一气呵成 ！</p>
<p>项目地址：https://github.com/vran-dev/databasir</p>
<p>文档地址：https://doc.databasir.com</p>
<h2 id="问题">问题</h2>
<p>在进入正题之前，我想先聊一聊在数据库文档维护这个细分场景下，我们平时遇到的一些问题。</p>
<p><strong>一、没有文档</strong></p>
<p>这是最普遍的一个问题，没有人会否认文档对一个团队的价值，但文档的维护成本也经常让人望而却步</p>
<p><strong>二、时间有限，这次就不写文档了</strong></p>
<p>在人力、时间等资源都有限的情况下我们通常会暂时放弃文档的维护而优先完成业务目标（这本无可厚非），长此以往就会导致文档内容与业务模型之间的差异越来越大，即文档失真了。</p>
<p><strong>三、百家齐放，格式标准不统一</strong></p>
<p>每个人对文档的格式标准都有自己的想法，只是团队内部消化的话，大家的容忍度还是很高的，如果涉及跨团队协作的话，一个统一的格式标准能提高内容质量的最低下限。</p>
<p><strong>四、失忆症，忘记补充文档</strong></p>
<p>模型的变更 80% 的场景都是增量变化，比如加个字段、加一张表等，加了字段和表以后如果忘了更新文档就会造成前面提到的文档失真，但这非刻意为之，更类似于失忆症，根本原因与第二点不同。</p>
<p>现实中的问题远不止这些，但我们可以看看 <a href="https://github.com/vran-dev/databasir">Databasir</a> 面对这些场景给出的答案，下面就进入 Show time 吧。</p>
<h2 id="自动化文档的事儿你不用操心">自动化，文档的事儿你不用操心</h2>
<p>Databasir 基于 JDBC 实现了对数据库表、列、索引、外键等结构的解析，通过解析后的元数据再自动生成标准化的文档内容，从而替代了人工输出文档这种传统方式，节省人力的同时又降低了错误率。</p>
<p>目前 Databasir 生成的文档内容包含以下信息</p>
<ul>
<li>表信息</li>
<li>列信息</li>
<li>索引信息</li>
<li>外键信息</li>
<li>触发器信息（仅 Mysql 支持）</li>
</ul>
<p>文档页面的布局采用了经典的两栏布局，左侧显示所有的表信息，右侧显示文档的详细内容，如下图所示</p>
<p><img src="img/auto1.png" alt=""></p>
<p><img src="img/auto2.png" alt=""></p>
<p>到这儿还算不上自动化，只能算是半自动化，因为每次模型结构有变更的话还需要手动再同步一下，如果忘了同步就会造成前面提到的文档失真问题。</p>
<p>为了完全的自动化，Databasir 提供了定时自动同步机制，用户可以通过 cron 表达式设置同步时间。</p>
<p>下图展示了定时同步的配置页面</p>
<p><img src="img/auto3.png" alt=""></p>
<p>系统会根据配置的时间定时检查模型是否有变更，如果有变更的话就会更新并生成一个新的文档版本，并通过邮件的形式将变更内容通知到相关方。</p>
<p><img src="img/auto-5.png" alt=""></p>
<p>除了标准的文档内容以外，Databasir 还支持 UML 格式文档生成，如果业务模型有使用到外键，那 UML 之间还能自动根据外键关系生成关联箭头。</p>
<p><img src="img/auto4.png" alt=""></p>
<h2 id="版本化内容变更一目了然">版本化，内容变更一目了然</h2>
<p>文档版本化可以让我们将文档轻松的回溯到任意指定存档点，在 Databasir 中版本号目前是一个递增的数字，数字越大代表版本越新。</p>
<p>在同步文档时检测到模型有变更才会创建新的版本号，这里的检测使用到了自研的 DIFF 引擎，目前支持以下内容的变更检测</p>
<ol>
<li>数据库信息，比如版本号、产品切换</li>
<li>表信息，基于名称比对其他字段的变更，比如注释变更</li>
<li>列信息，基于名称比对其他字段的变更，比如类型变更，注释变更</li>
<li>索引信息，基于名称比对其他字段的变更，比如关联列变更</li>
<li>触发器信息，基于名称比对其他字段的变更</li>
<li>外键信息，基于名称比对其他字段的变更，比如关联列变更</li>
</ol>
<p>下图展示了版本的切换功能</p>
<p><img src="img/version1.png" alt=""></p>
<p>得益于自研的 DIFF 引擎，Databasir 的文档内容可以实现任意版本的差异对比。</p>
<p>在文档页面启用<code>显示版本差异</code>开关，然后选择要对比的旧版本</p>
<p><img src="img/version2.png" alt=""></p>
<p>再看一眼上图，文档内容通过三个高亮颜色来区分差异类型</p>
<ul>
<li>绿色：表示新增的内容</li>
<li>红色：表示被删除的内容</li>
<li>黄色：表示被修改的内容</li>
</ul>
<p>比如下图我选择了一个版本号为 18 的内容与当前版本做对比，系统提示有以下变更内容</p>
<ul>
<li>dept_emp 表被修改</li>
<li>document_description 被修改</li>
<li>oauth_app 是新增的表</li>
</ul>
<p><img src="img/version3.png" alt=""></p>
<p>表具体的修改内容，可以在表内容展示位置查看，如下图就展示了 <code>document_description</code> 的具体变更内容</p>
<p><img src="img/version5.png" alt=""></p>
<p>注意黄色的 <code>content</code> 字段由两行组成，其中高亮黄色标识是当前版本的信息，灰色的是旧版本的信息。</p>
<h2 id="团队化该有的都有了">团队化，该有的都有了</h2>
<p>既然是面向团队的文档管理产品，那么自然就得考虑团队通常需要的功能</p>
<ul>
<li>权限</li>
<li>协作</li>
<li>系统集成</li>
<li>审计</li>
</ul>
<p>先说权限， Databasir 的基本理念是<strong>开放</strong>，即所有合法的用户都应该有权限查看团队的文档，这样做可以保证信息的价值最大化，避免孤岛效应。</p>
<p>为此，在 Databasir 中将用户分为四种角色</p>
<ul>
<li>普通用户：即能登录系统的用户，能查看所有分组和所有文档</li>
<li>组员：某个分组的普通成员，拥有所属分组的所有读权限，部分写权限</li>
<li>组长：分组的负责人，拥有所属分组的所有权限</li>
<li>系统管理员：拥有系统最高权限</li>
</ul>
<p><img src="img/group1.png" alt=""></p>
<p><img src="img/group2.png" alt=""></p>
<p>而在协作方面，文档内容支持针对表、列、索引进行跨团队的讨论</p>
<p><img src="img/discuss1.png" alt=""></p>
<p>系统集成方面，Databasir 支持 Github / Gitlab 的 OAuth2 登录配置，仅需简单的配置即可</p>
<p><img src="img/oauth1.png" alt=""></p>
<p>操作审计方面，Databasir 支持完整的系统日志查看</p>
<p><img src="img/audit1.png" alt=""></p>
<h2 id="个性化20-的需求也满足">个性化，20% 的需求也满足</h2>
<p>程序员对功能的要求是最为挑剔的，既要简单又不能复杂，在这方面 Databasir 尽管不能做到 100% 满意，那也是为这 20% 的需求付出了 80% 的努力。</p>
<p>第一个个性化的能力就是数据库类型的扩展。</p>
<p>Databasir 为 Mysql 和 Postgresql 两款数据库提供了开箱即用的配置，但这并不代表其他数据库就不能用了，理论上 Databasir 是支持所有拥有 JDBC 驱动的数据库类型的，比如常见的</p>
<ul>
<li>sqlserver</li>
<li>oracle</li>
<li>h2</li>
<li>&hellip;</li>
</ul>
<p>扩展它们只需要简单的图形化配置即可，如下图所示</p>
<p><img src="img/custom1.png" alt=""></p>
<p>用户可以在 Maven 仓库找到对应的数据库 JDBC 驱动地址填进表单，Databasir 负责下载并动态加载驱动去连接数据库。</p>
<p>注意哦，由于某些众所周知的原因，驱动的下载地址请尽量选择国内的公共镜像仓库，比如阿里云或企业自建的私库。</p>
<p>除了数据库的扩展外，Databasir 也努力支持为文档内容进行自定义，比如文档内容中的表格头默认都是英文字段显示，如下</p>
<p><img src="img/custom2.png" alt=""></p>
<p>这些你都可以通过模板进行编辑，下图就展示了将表头的英文替换成了中文，未来将还会支持字段的隐藏与展示</p>
<p><img src="img/custom3.png" alt=""></p>
<p>保存以后再次查看文档，所有的表头就是我们自己设置的中文名称了，而且导出的文档文件也同样生效</p>
<p><img src="img/custom4.png" alt=""></p>
<h2 id="未来规划">未来规划</h2>
<p>由于时间和精力有限，Databasir 目前尚有许多功能正在规划之中，短期内会着重关注以下几点</p>
<ul>
<li>提供更多的事件通知，比如被加入分组、成为组长等</li>
<li>提供文档内容自定义程度，比如字段的展示与隐藏，字段值自定义等</li>
<li>丰富文档文件导出格式，比如 Excel、DOC、PDF 等</li>
<li>项目质量，补充足够的单元测试</li>
</ul>
<h2 id="结语">结语</h2>
<p>文档的重要性是毋庸置疑的，随着时间线的拉长，它的价值回报会越来越高，但对于初创团队来说生存才是第一要务，短期的高成本与低收益让团队不得不做出暂时放弃维护文档的决策，而 Databasir 的目标就是要解决这个矛盾点，在占用极低资源的情况下让团队不仅能活在当下，还能立足未来。</p>
<p>如果你对这个产品有兴趣，请在 Github 点击 star 持续关注发展</p>
<p>Github：https://github.com/vran-dev/databasir</p>
<p>文档地址：https://doc.databasir.com</p>
<p>项目反馈：https://github.com/vran-dev/databasir/issues</p>
<p>如果你有更好的建议，也可以通过公众号私信反馈</p>
<p>公众号：vran</p>
<p>二维码：</p>
<p><img src="img/qrcode.jpg" alt=""></p>

            </section>

            <div class="over">
                <div class="line"></div>
                <span>over</span>
                <div class="line"></div>
            </div>
        </article>
        <div class = "social">

    
        <a href="https://github.com/vran-dev">
            <svg t="1612751476854" class="social-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9196" width="22" height="22">
                <path d="M63.681087 516.285293c0 210.288698 144.593659 387.06044 340.109608 435.411104 8.963443 2.334559 18.979018-5.66029 18.685506-14.948855V740.533933c0-9.954615 5.899616-19.5096 16.818309-25.228593 11.097059-5.5474 8.380932-25.607902-3.738907-28.030515-56.790299-11.356705-105.233532-34.160427-139.233656-64.471315-33.930132-30.367333-53.245562-67.216792-53.245561-106.518217 0-27.359951 9.783022-53.611324 27.084499-77.566521a14.623733 14.623733 0 0 0 2.817728-8.365127v-142.999656l118.721594 63.536587c3.619244 1.971054 8.143864 2.291661 12.088231 0.889571 33.284403-9.868819 69.433946-14.890153 108.385412-14.890153 38.949208 0 75.096494 5.021334 108.385413 14.948856a15.36429 15.36429 0 0 0 12.146933-0.891829l118.662892-63.59529v142.91386a15.115932 15.115932 0 0 0 2.801922 8.42383c17.346633 23.925846 27.098046 50.235922 27.098047 77.564263 0 39.333033-19.268016 76.180235-53.200406 106.547568-34.043022 30.310888-82.5427 53.083-139.278811 64.471315-12.115324 2.363911-14.77049 22.42667-3.73665 27.971813 10.923209 5.723508 16.822825 15.240111 16.822825 25.23085v196.215867c-0.295771 9.28405 9.749156 17.281157 18.685505 14.948855C816.104564 903.343476 960.668872 726.517546 960.668872 516.285293c0-247.50392-201.00239-448.495021-448.492764-448.495021-247.50392 0-448.495021 200.991101-448.495021 448.495021z m448.495021-418.595052c231.37198 0 418.590537 187.236619 418.590537 418.595052 0 189.266376-126.779662 345.246091-298.995176 397.046664v-172.800282c0-11.970825-4.610416-22.60052-11.209949-31.769422 49.723403-13.666429 95.127645-35.156114 127.946942-64.471315 38.922115-34.600697 62.660564-78.952807 62.660564-128.005645 0-32.381285-11.794717-62.003545-29.897711-88.808078v-165.336015c0.085796-10.469392-13.314213-18.322-22.428928-13.068113l-137.34614 73.755365c-34.108498-9.254699-70.578648-15.840684-109.320139-15.840685-38.718913 0-75.277118 6.525025-109.322397 15.840685l-137.352913-73.726013c-9.094395-5.253887-22.510209 2.598721-22.424412 13.068113v165.336014c-18.116541 26.806791-29.899969 56.429051-29.899969 88.808079 0 49.025744 23.7678 93.375596 62.617665 127.978551 32.878 29.373903 78.32514 50.804886 127.962747 64.532275-6.572439 9.137293-11.185113 19.737637-11.185113 31.737813v50.482022c-32.584486 12.149191-54.015469 14.718561-67.275495 12.149191-14.291838-2.829016-21.999947-10.189425-30.787282-22.426671-17.70788-24.646082-35.083865-69.989364-92.546986-84.820814-19.547983-5.222278-26.161062 23.912299-7.475557 28.996852 45.081378 11.67957 53.972571 43.329329 75.638365 73.579256 10.889342 15.068519 26.497473 29.084905 49.578904 33.636619 19.227376 3.736649 42.498461 0.878282 72.863535-9.372104v90.600767c-172.156811-51.825409-298.995176-207.834475-298.995175-397.100851 0.009031-231.360691 187.24565-418.59731 418.604083-418.59731z" fill="#707070" p-id="9197"></path>
            </svg>  
        </a>
    

    
        <a href='#'>
            <svg t="1612751098681" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16516" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="16517"></path><path d="M792.845583 353.808158a119.106898 119.106898 0 0 0 8.717476-20.532369 17.083697 17.083697 0 0 0-24.939005-19.893726 192.646626 192.646626 0 0 1-52.560309 21.490333 122.332044 122.332044 0 0 0-81.810154-31.517026 121.980791 121.980791 0 0 0-121.789198 126.866409 281.673444 281.673444 0 0 1-183.130847-101.480355 17.115629 17.115629 0 0 0-27.972558 2.235251 121.757266 121.757266 0 0 0-2.107522 118.819508 20.053387 20.053387 0 0 0-6.833478 2.490707 18.233254 18.233254 0 0 0-8.430087 15.359362c0 36.242984 16.125733 69.516278 42.118499 92.124236l-1.117625 1.117625a17.051765 17.051765 0 0 0-3.448672 16.54085 121.853062 121.853062 0 0 0 69.739803 75.519521 195.871772 195.871772 0 0 1-108.760883 18.488712 17.403019 17.403019 0 0 0-18.073594 11.240115 17.115629 17.115629 0 0 0 6.865411 20.117251 314.244231 314.244231 0 0 0 169.847075 49.782212c197.340651 0 315.297992-160.299364 315.297992-315.266059l-0.031932-5.236872a227.420731 227.420731 0 0 0 49.207434-53.007359 17.083697 17.083697 0 0 0-20.787826-25.258326z m-55.721591 56.040913a17.083697 17.083697 0 0 0-7.088936 14.720718c0.191593 4.215043 0.287389 8.49395 0.287389 12.708994 0 138.20232-105.152551 281.16253-281.130598 281.162529a279.725583 279.725583 0 0 1-92.1881-15.582886 225.856056 225.856056 0 0 0 97.233379-44.385681 17.083697 17.083697 0 0 0-10.218286-30.495197 87.877261 87.877261 0 0 1-70.059124-37.105152c8.078832-0.542846 15.998004-1.883997 23.693651-3.959586a17.051765 17.051765 0 0 0-1.149558-33.20943 87.526007 87.526007 0 0 1-66.450792-60.830734c8.49395 2.139454 17.211426 3.384807 25.928901 3.672196 7.504054-0.031932 14.465261-4.630161 16.796308-11.846825s-0.415118-15.167768-6.769614-19.382812a87.685668 87.685668 0 0 1-36.498441-94.040164 315.585381 315.585381 0 0 0 209.730323 94.902332c5.620057 0.031932 10.537608-1.979793 13.954347-6.099039s4.725957-9.579643 3.512536-14.816515a87.813397 87.813397 0 0 1 149.506299-80.021954 17.083697 17.083697 0 0 0 15.774479 5.077211c5.268804-1.053761 10.473743-2.267182 15.614819-3.672196a81.043782 81.043782 0 0 1-7.216665 4.821753 17.083697 17.083697 0 0 0 10.793065 31.548959l5.81165-0.734439a178.979668 178.979668 0 0 1-9.867032 7.567918z" fill="#828282" p-id="16518"></path>
            </svg>
        </a>
    

    
        <a href='#' >
            <svg t="1612751005803" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13371" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="13372"></path><path d="M623.796812 224.610702h-85.194961C430.096425 223.525009 416.237875 290.678309 416.237875 363.355869V416.203567h-47.898217a14.209804 14.209804 0 0 0-15.966072 15.966073v95.796432a14.209804 14.209804 0 0 0 15.966072 15.966072H416.237875v239.491082a14.337533 14.337533 0 0 0 16.061868 15.966072h97.552701c9.419983 1.085693 17.051765-6.54609 14.050143-15.966072L543.966451 543.932144h79.830361a14.209804 14.209804 0 0 0 15.966072-15.966072v-95.796432a14.209804 14.209804 0 0 0-15.966072-15.966073h-79.926157L543.966451 368.305351c3.097418-20.40464 3.097418-17.083697 22.03318-15.966072h57.126606c4.438568-0.989896 9.164525-0.44705 12.485468-3.672197 3.320943-3.225147 5.236872-7.631782 4.119247-12.293875v-95.796433A14.177872 14.177872 0 0 0 623.796812 224.610702z m-17.083697 94.008233l-40.042909-1.532743c-49.59062 0-53.741799 26.918798-53.741799 54.476238l-0.127728 60.543345a17.051765 17.051765 0 0 0 17.051765 17.083697H607.83074v61.692903h-77.914432a17.083697 17.083697 0 0 0-17.083697 17.051765L512.800679 767.457154H448.170019v-239.491082c0-9.419983-6.418361-17.051765-15.870276-17.051765H384.30573v-61.692902h47.994013a17.051765 17.051765 0 0 0 12.070351-4.981415c3.193214-3.225147 3.767993-7.567918 3.767993-12.102283v-68.81377c0-71.591867 14.465261-105.695397 90.431832-105.695398h68.111263v60.990396z" fill="#828282" p-id="13373"></path>
            </svg>
        </a>
    

    

</div>
        
        
        <div>
            <script src="https://utteranc.es/client.js"
repo='vran-dev/vran-dev.github.io'
issue-term="pathname"
label="Comment"
theme="github-light"
crossorigin="anonymous"
async>

</script>
        </div>
        

    </section>

    <footer id="footer">
    <p>
        
        © 2023 <i></i> vran
        
        ∘ Powered by <a href="http://www.gohugo.io/">Hugo</a>  ∘  Theme <a href="https://github.com/vran-dev/hugo-zenHo">ZenHo</a>
    </p>
</footer>


<script>
    var token = 'bacd84bd97ed2e6eef56ec4cae65acdb';
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?" + token;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
