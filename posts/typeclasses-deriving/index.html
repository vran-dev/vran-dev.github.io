<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        

		<meta name="author" content="vran">
		
		<meta name="generator" content="Hugo 0.80.0" />
		<title> Scala2 如何实现 Type class 派生 &middot; 且徐行</title>
		<link rel="shortcut icon" href="https://blog.cc1234.cc/images/favicon.ico">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/style.css">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/highlight.css">
</head>


<body>
    <section id="single" class="wrapper">
    <nav class="nav-main" style="display: flex;">
         <div style="margin-left:auto;">
            
            <a href='https://blog.cc1234.cc/'> Home</a>
            <a href='https://blog.cc1234.cc/posts'>Archive</a> 
            <a href='https://blog.cc1234.cc/tags'>Tags</a> 
            <a href='https://blog.cc1234.cc/about'>About</a>
   
           
         </div>
</nav>

        <article class = "post">
            <header>
                <div class = "post-img">
                    
                </div>
                <div class = "title" >
                     Scala2 如何实现 Type class 派生
                </div>
                <div class="meta">
                2020/08/15
                · vran
                </div>
            </header>
            <div class = "line"></div>
            
            <section class="content">
                <h2 id="前言">前言</h2>
<p>本文主要是讨论在 Scala 中自动为 case class 派生 Type class 实例，如果你不知道什么是 Type class 的话，建议先阅读我的上一篇文章 <em><a href="https://blog.cc1234.cc/posts/typeclasses-1/">《真的学不动了： 除了 class , 也该了解 Type classes 了》</a></em>。</p>
<blockquote>
<p>本文使用的 Scala 版本为 2.13.2，Shapless 版本为 2.3.3</p>
</blockquote>
<h2 id="提出问题">提出问题</h2>
<p>假设我现在有一个用于生成随机测试数据的 Type class，并且已经实现了 Int， Boolean 等基本类型的 Random 实例</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">trait</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span>
<span style="color:#000">}</span>

<span style="color:#a90d91">object</span> <span style="color:#3f6e75">Random</span> <span style="color:#000">{</span>
  
  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]()(</span><span style="color:#a90d91">implicit</span> <span style="color:#000">random</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">])</span> <span style="color:#a90d91">=</span> <span style="color:#000">random</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">()</span>
  
  <span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">intRandom</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Int</span><span style="color:#000">]</span> <span style="color:#000">{</span>
    <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span> <span style="color:#000">=</span> <span style="color:#3f6e75">Math</span><span style="color:#000">.</span><span style="color:#000">abs</span><span style="color:#000">(</span><span style="color:#000">scala</span><span style="color:#000">.</span><span style="color:#000">util</span><span style="color:#000">.</span><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">nextInt</span><span style="color:#000">(</span><span style="color:#1c01ce">10000000</span><span style="color:#000">))</span>
  <span style="color:#000">}</span>

  <span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">stringRandom</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">String</span><span style="color:#000">]</span> <span style="color:#000">{</span>
    <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span> <span style="color:#000">=</span> <span style="color:#3f6e75">UUID</span><span style="color:#000">.</span><span style="color:#000">randomUUID</span><span style="color:#000">().</span><span style="color:#000">toString</span>
  <span style="color:#000">}</span>

  <span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">booleanRandom</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Boolean</span><span style="color:#000">]</span> <span style="color:#000">{</span>
    <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Boolean</span> <span style="color:#000">=</span> <span style="color:#000">scala</span><span style="color:#000">.</span><span style="color:#000">util</span><span style="color:#000">.</span><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">nextBoolean</span><span style="color:#000">()</span>
  <span style="color:#000">}</span>
  
  <span style="color:#177500">// ......
</span><span style="color:#177500"></span><span style="color:#000">}</span>
</code></pre></div><p>这样就可以像下面这样生成基本类型的随机数据了，编译器会自动找到对应的实例进行注入</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a90d91">import</span> <span style="color:#000">Random._</span>

<span style="color:#177500">// 相当于 Random.apply[Int]()(intRandom), scala 可以省略 apply
</span><span style="color:#177500"></span><span style="color:#000">val</span> <span style="color:#000">id</span> <span style="color:#000">=</span> <span style="color:#000">Random</span><span style="color:#000">[</span><span style="color:#000">Int</span><span style="color:#000">]()</span>
  
<span style="color:#177500">// 相当于 Random.apply[String]()(stringRandom)
</span><span style="color:#177500"></span><span style="color:#000">val</span> <span style="color:#000">name</span> <span style="color:#000">=</span> <span style="color:#000">Random</span><span style="color:#000">[</span><span style="color:#000">String</span><span style="color:#000">]()</span>
</code></pre></div><p>但在实际开发中，经常要面对很多组合类型， 比如下面的 Doctor 和 User 类型</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Doctor</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">)</span>

<span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">,</span> <span style="color:#000">name</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">,</span> <span style="color:#000">isCertified</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Boolean</span><span style="color:#000">)</span>
</code></pre></div><p>如果要使用 Random 生成这样的数据就得实现 Random[User]、Random[Doctor] 实例</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">userShow</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">User</span> <span style="color:#000">=</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#000">scala</span><span style="color:#000">.</span><span style="color:#000">util</span><span style="color:#000">.</span><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">nextInt</span><span style="color:#000">(),</span> <span style="color:#3f6e75">UUID</span><span style="color:#000">.</span><span style="color:#000">randomUUID</span><span style="color:#000">().</span><span style="color:#000">toString</span><span style="color:#000">,</span> <span style="color:#000">scala</span><span style="color:#000">.</span><span style="color:#000">util</span><span style="color:#000">.</span><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">nextBoolean</span><span style="color:#000">())</span>
<span style="color:#000">}</span>

<span style="color:#177500">// ... 省略 Doctor 的实例
</span></code></pre></div><p>上面的实现没有复用已有的 Random[Int], Random[Boolean] 和 Random[String] 实例，为了做到复用，一般会使用隐式方法来实现：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">implicit</span> <span style="color:#a90d91">def</span> <span style="color:#000">userRandom</span><span style="color:#000">(</span><span style="color:#a90d91">implicit</span> <span style="color:#000">intRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Int</span><span style="color:#000">],</span>
                        <span style="color:#000">stringRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">String</span><span style="color:#000">],</span>
                        <span style="color:#000">booleanRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Boolean</span><span style="color:#000">])</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">User</span> <span style="color:#000">=</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#000">intRandom</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">(),</span> <span style="color:#000">stringRandom</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">(),</span> <span style="color:#000">booleanRandom</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">())</span>
<span style="color:#000">}</span>

<span style="color:#177500">// 相当于 Random.apply[User]()(userRandom(intRandom, stringRandom, booleanRandom))
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">user</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]()</span>
</code></pre></div><p>通过 Random[User]() 的调用简单说一下编译器的推导过程</p>
<p>1、调用 Random[User] 实际是调用的</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">apply</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]()(</span><span style="color:#a90d91">implicit</span> <span style="color:#000">random</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">])</span>
</code></pre></div><p>2、编译器没有找到 Random[User] 实例，但是发现方法 <strong>implicit def userRandom</strong> 会返回一个 Random[User]，于是调用该方法</p>
<p>3、<strong>implicit def userRandom</strong>  又需要 Random[Int]、Random[String] 和 Random[Boolean] 等隐式实例，编译器在作用域内找到对应实例并注入</p>
<p>userRandom 函数虽然复用了已有的 Random 实例，但还是没有解决每一个新的 case class 都需要实现一个对应的  Random 实例这个问题。</p>
<p>有没有一种办法可以自动为 case class 派生 Type class 实例呢？有，Shapeless 就是答案之一</p>
<p><img src="img/deriving-word.png" alt="image-20200822184653606"></p>
<h2 id="shapeless">Shapeless</h2>
<p><a href="https://github.com/milessabin/shapeless">Shapeless</a> 是一个为 Scala 编写的通用的类型级编程库，它提供的 HList 和 Generic 可以帮助我们实现 Type class 的派生。</p>
<p>这里的派生指的是我们的 Type class 能处理任意 case class， 就像是专门为该类型实现了一个 Type class 实例一样。</p>
<p>下面先来简单了解一下 HList 和 Generic。</p>
<h3 id="hlist">HList</h3>
<p><code>HList</code> 是 <strong>Heterogenous lists</strong> 的简写，一般叫做<strong>异类列表</strong>，这里的异类指的是 HList 中的元素可以是不同的类型（就像 Tuple 一样）。</p>
<p><code>HList</code> 本身是一个特质（类似于接口），有着 <code>HNil</code> 和 <code>::</code> 两个实现类</p>
<p>注：<code>::</code> 是类名，Scala 支持使用符号作为类型名称</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">sealed</span> <span style="color:#a90d91">trait</span> <span style="color:#3f6e75">HList</span>

<span style="color:#177500">// HNil 代表空元素的 HList
</span><span style="color:#177500"></span><span style="color:#a90d91">sealed</span> <span style="color:#a90d91">trait</span> <span style="color:#3f6e75">HNil</span> <span style="color:#a90d91">extends</span> <span style="color:#3f6e75">HList</span> 
<span style="color:#a90d91">case</span> <span style="color:#a90d91">object</span> <span style="color:#3f6e75">HNil</span> <span style="color:#a90d91">extends</span> <span style="color:#3f6e75">HNil</span>


<span style="color:#177500">// 第二个参数 tail 也是 `HList` 类型的，也就是递归定义的。
</span><span style="color:#177500"></span><span style="color:#a90d91">final</span> <span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">::</span><span style="color:#000">[</span><span style="color:#a90d91">+H</span>, <span style="color:#a90d91">+T</span> <span style="color:#a90d91">&lt;:</span> <span style="color:#a90d91">HList</span><span style="color:#000">](</span><span style="color:#000">head</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">H</span><span style="color:#000">,</span> <span style="color:#000">tail</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span><span style="color:#000">)</span> <span style="color:#a90d91">extends</span> <span style="color:#3f6e75">HList</span>
</code></pre></div><p>下面展示了一个简单的 <code>::</code> 类的构造</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">val</span> <span style="color:#000">hListObject</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">:</span><span style="color:#a90d91">:</span><span style="color:#000">(</span><span style="color:#000">&#34;</span><span style="color:#a90d91">String</span><span style="color:#000">&#34;</span><span style="color:#000">,</span> <span style="color:#a90d91">::</span><span style="color:#000">(</span><span style="color:#000">1</span><span style="color:#000">,</span> <span style="color:#a90d91">::</span><span style="color:#000">(</span><span style="color:#000">2</span><span style="color:#a90d91">.</span><span style="color:#000">2</span><span style="color:#a90d91">F</span><span style="color:#000">,</span> <span style="color:#a90d91">HNil</span><span style="color:#000">)))</span>
</code></pre></div><p>shapeless 还提供了很多隐式转换方法，可以更便捷的构造 HList</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">import</span> <span style="color:#000">shapeless._</span>

<span style="color:#177500">// 这里的 :: 是 case class 构造器
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">jack</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">:</span><span style="color:#a90d91">:</span><span style="color:#000">(</span><span style="color:#000">&#34;</span><span style="color:#a90d91">Jack</span><span style="color:#000">&#34;</span><span style="color:#000">,</span> <span style="color:#a90d91">::</span><span style="color:#000">(</span><span style="color:#000">18</span><span style="color:#000">,</span> <span style="color:#a90d91">::</span><span style="color:#000">(</span><span style="color:#000">50</span><span style="color:#a90d91">.</span><span style="color:#000">5</span><span style="color:#a90d91">d</span><span style="color:#000">,</span> <span style="color:#a90d91">HNil</span><span style="color:#000">)))</span>

<span style="color:#177500">// 下面的 :: 是一个隐式转换方法
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">tom</span> <span style="color:#a90d91">=</span> <span style="color:#c41a16">&#34;Tom&#34;</span> <span style="color:#a90d91">:</span><span style="color:#a90d91">:</span> <span style="color:#000">18</span> <span style="color:#a90d91">::</span> <span style="color:#000">50</span><span style="color:#a90d91">.</span><span style="color:#000">5</span><span style="color:#a90d91">d</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">HNil</span>
</code></pre></div><p>对比一下 HList 和 case class，会发现它们的结构非常相似。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#000">name</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">,</span> <span style="color:#000">age</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">,</span> <span style="color:#000">weight</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Double</span><span style="color:#000">)</span>

<span style="color:#a90d91">val</span> <span style="color:#000">jack</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;jack&#34;</span><span style="color:#000">,</span> <span style="color:#1c01ce">18</span><span style="color:#000">,</span> <span style="color:#1c01ce">50.5d</span><span style="color:#000">)</span>      <span style="color:#177500">// case class
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">tom</span> <span style="color:#a90d91">=</span> <span style="color:#c41a16">&#34;Tom&#34;</span> <span style="color:#a90d91">:</span><span style="color:#a90d91">:</span> <span style="color:#000">18</span> <span style="color:#a90d91">::</span> <span style="color:#000">50</span><span style="color:#a90d91">.</span><span style="color:#000">5</span><span style="color:#a90d91">d</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">HNil</span>  <span style="color:#177500">// HList
</span></code></pre></div><p>正因为 HList 和 case class 的结构类似，所以它们也可以互相转换，而转换的方式就是使用  Generic。</p>
<h3 id="generic">Generic</h3>
<p>其实 Generic 的接口定义并不限于 HList 和 case class 的转换，它只是定义了 <strong>T</strong> 和 <strong>Repr</strong> 两个泛型，所以理论上是可以基于 Generic 去实现任意两种类型的转换的。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">trait</span> <span style="color:#3f6e75">Generic</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">type</span> <span style="color:#a90d91">Repr</span>
  
  <span style="color:#a90d91">def</span> <span style="color:#000">to</span><span style="color:#000">(</span><span style="color:#000">t</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span><span style="color:#000">)</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">Repr</span>
  
  <span style="color:#a90d91">def</span> <span style="color:#000">from</span><span style="color:#000">(</span><span style="color:#000">r</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">Repr</span><span style="color:#000">)</span> <span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span>
<span style="color:#000">}</span>

</code></pre></div><p>通过 Generic 的伴生对象可以很轻松的构建一个 Generic 实例，Generic 的实现使用了一个称之为 <a href="http://gigiigig.github.io/posts/2015/09/13/aux-pattern.html">Aux Pattern</a> 的手段，主要是为了绕过编译器的限制，这里可以不用深究。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">object</span> <span style="color:#3f6e75">Generic</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">type</span> <span style="color:#a90d91">Aux</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">Repr0</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Generic</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#000">{</span> <span style="color:#a90d91">type</span> <span style="color:#a90d91">Repr</span> <span style="color:#000">=</span> <span style="color:#3f6e75">Repr0</span> <span style="color:#000">}</span>
  
  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">](</span><span style="color:#a90d91">implicit</span> <span style="color:#000">gen</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Generic</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">])</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Aux</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">gen.Repr</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#000">gen</span>
<span style="color:#000">}</span>
</code></pre></div><p>下面的代码展示了如何使用 Generic 在 <code>case class User</code> 和 <code>HList</code> 之间进行转换</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">val</span> <span style="color:#000">generic</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Generic</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]</span>

<span style="color:#177500">// case class =&gt; HList
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">userHList</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">::</span><span style="color:#000">[</span><span style="color:#a90d91">String</span>, <span style="color:#a90d91">::</span><span style="color:#000">[</span><span style="color:#a90d91">Int</span>, <span style="color:#a90d91">::</span><span style="color:#000">[</span><span style="color:#a90d91">Double</span>, <span style="color:#a90d91">HNil</span><span style="color:#000">]]]</span> <span style="color:#a90d91">=</span> <span style="color:#000">generic</span><span style="color:#000">.</span><span style="color:#000">to</span><span style="color:#000">(</span><span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Jack&#34;</span><span style="color:#000">,</span> <span style="color:#1c01ce">18</span><span style="color:#000">,</span> <span style="color:#1c01ce">50</span><span style="color:#000">))</span>

<span style="color:#177500">// HList =&gt; case class
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">userClass</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">User</span> <span style="color:#000">=</span> <span style="color:#000">generic</span><span style="color:#000">.</span><span style="color:#000">from</span><span style="color:#000">(</span><span style="color:#000">userHList</span><span style="color:#000">)</span>
</code></pre></div><p>因为 Shapeless 已经在隐式作用域内提供了能转换 case class 和 HList 的 Generic.Aux 实例，所以我们也可以通过下面的方式来进行转换</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">import</span> <span style="color:#000">shapeless._</span>

<span style="color:#177500">// 定义 case class
</span><span style="color:#177500"></span><span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Demo</span><span style="color:#000">()</span>

<span style="color:#177500">// 接受一个 case class，返回一个 HList。
</span><span style="color:#177500">// Generic.Aux[C, HL] 的实例在 Shapeless 库中已经有了
</span><span style="color:#177500"></span><span style="color:#a90d91">def</span> <span style="color:#000">genericTest</span><span style="color:#000">[</span><span style="color:#a90d91">C</span>, <span style="color:#a90d91">HL</span> <span style="color:#a90d91">&lt;:</span> <span style="color:#a90d91">HList</span><span style="color:#000">](</span><span style="color:#000">t</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">C</span><span style="color:#000">)(</span><span style="color:#a90d91">implicit</span> <span style="color:#000">gen</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Generic.Aux</span><span style="color:#000">[</span><span style="color:#a90d91">C</span>, <span style="color:#a90d91">HL</span><span style="color:#000">])</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">HList</span> <span style="color:#000">=</span> <span style="color:#000">{</span>
  <span style="color:#000">gen</span><span style="color:#000">.</span><span style="color:#000">to</span><span style="color:#000">(</span><span style="color:#000">t</span><span style="color:#000">)</span>
<span style="color:#000">}</span>

<span style="color:#000">genericTest</span><span style="color:#000">(</span><span style="color:#3f6e75">Demo</span><span style="color:#000">())</span>  <span style="color:#177500">// Demo 转为了 HNil
</span></code></pre></div><h2 id="思路">思路</h2>
<p>那么如何借助 Shapeless 来为 case class 自动派生 Type class 实例呢？</p>
<p>其实思路很简单：既然 case class 都能转为 HList，那么都复用 HList 的 Type class 实例不就可以了吗？</p>
<p>这样问题就变成了</p>
<ul>
<li>自动将 case class 转为 HList</li>
<li>实现 HList 的 type class 实例</li>
</ul>
<p>第一个问题 Shapless 框架已经提供了解决方案，所以重点就是第二个问题的解决。</p>
<p>如下图所示，HList 的结构可以被递归的分解为 「头节点 + 尾列表」（递归结构），递归的终止条件就是尾列表为 HNil 时：</p>
<p><img src="img/HList-decompose.png" alt="image-20200822130953933"></p>
<p>用代码展示就是这样</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#3f6e75">HList</span><span style="color:#000">(</span><span style="color:#000">T1</span><span style="color:#000">,</span> <span style="color:#3f6e75">HList</span><span style="color:#000">(</span><span style="color:#000">T2</span><span style="color:#000">,</span> <span style="color:#3f6e75">HList</span><span style="color:#000">(</span><span style="color:#000">T3</span><span style="color:#000">,</span> <span style="color:#3f6e75">HList</span><span style="color:#000">(</span><span style="color:#000">T4</span><span style="color:#000">,</span> <span style="color:#3f6e75">HNil</span><span style="color:#000">))))</span>
</code></pre></div><p>那么 HList 的 Type class 实例实际就是<strong>组合 T 类型和 HList 类型的实例</strong>，所以将问题又可以分解为</p>
<ul>
<li>实现单个元素类型（如 T1、T2、T3、T4等）的 Type class 实例</li>
<li>实现 HNil 的 Type class 实例</li>
<li>实现 HList 的 Type class 实例</li>
</ul>
<p>我们希望只要提供了以上 Type class 实例以后，编译器能按下图的方式自动推导（白色的代表匹配到的 Type class 实例）</p>
<p><img src="img/caseClass-deriving.png" alt="image-20200822131516132"></p>
<p>好了，Talk is Cheap，Show me the code</p>
<h2 id="实现">实现</h2>
<p>我们基于最开始的 Random[T] 来进行实现</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">trait</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span>
<span style="color:#000">}</span>

<span style="color:#a90d91">object</span> <span style="color:#3f6e75">Random</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]()(</span><span style="color:#a90d91">implicit</span> <span style="color:#000">random</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">])</span> <span style="color:#a90d91">=</span> <span style="color:#000">random</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">()</span>
<span style="color:#000">}</span>
</code></pre></div><p>基于前一小节方案，我们先来实现针对 HList 类型的 Random 实例，HList 有两个子类：<code>HNil</code> 和 <code>::</code> ，所以要实现两个实例。</p>
<p>HNil 的很简单，它表示没有任何值了，直接返回 HNil 就可以了</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">hNilRandom</span> <span style="color:#a90d91">=</span>  <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">HNil</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">HNil</span> <span style="color:#000">=</span> <span style="color:#3f6e75">HNil</span>
<span style="color:#000">}</span>
</code></pre></div><p><code>::</code> 是递归定义的，实际就是前一节分析的由 「头节点 +尾列表」 组成，所以 <code>::</code> 的 Random 实例就是<strong>组合头节点类型的实例和尾列表 HList  的实例</strong>，这就得用到隐式方法了</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#177500">/**
</span><span style="color:#177500"> * 生成 :: 类型的 Type class 实例
</span><span style="color:#177500"> *
</span><span style="color:#177500"> * @tparam T  任意类型
</span><span style="color:#177500"> * @tparam HL 任意 HList 类型
</span><span style="color:#177500"> */</span>
<span style="color:#a90d91">implicit</span> <span style="color:#a90d91">def</span> <span style="color:#000">hListRandom</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">HL</span> <span style="color:#a90d91">&lt;:</span> <span style="color:#a90d91">HList</span><span style="color:#000">](</span><span style="color:#a90d91">implicit</span> <span style="color:#000">tRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">],</span>
                                         <span style="color:#000">hListRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">HL</span><span style="color:#000">])</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">::</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">HL</span><span style="color:#000">]]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">::</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">HL</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">:</span><span style="color:#a90d91">:</span><span style="color:#000">(</span><span style="color:#a90d91">tRandom.random</span><span style="color:#000">(),</span> <span style="color:#a90d91">hListRandom.random</span><span style="color:#000">())</span>
<span style="color:#000">}</span>
</code></pre></div><p>Random[T] 就是基本类型的实例，复用前面定义的就可以了</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">stringRandom</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">String</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span> <span style="color:#000">=</span> <span style="color:#3f6e75">UUID</span><span style="color:#000">.</span><span style="color:#000">randomUUID</span><span style="color:#000">().</span><span style="color:#000">toString</span>
<span style="color:#000">}</span>

<span style="color:#a90d91">implicit</span> <span style="color:#a90d91">val</span> <span style="color:#000">booleanRandom</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Boolean</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Boolean</span> <span style="color:#000">=</span> <span style="color:#000">scala</span><span style="color:#000">.</span><span style="color:#000">util</span><span style="color:#000">.</span><span style="color:#3f6e75">Random</span><span style="color:#000">.</span><span style="color:#000">nextBoolean</span><span style="color:#000">()</span>
<span style="color:#000">}</span>

<span style="color:#177500">// ......
</span></code></pre></div><p>这样针对  HList 的实例就算完成了，可以试验一下</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#177500">// 编译通过, 生成类型 shapeless.::[Int,shapeless.::[String,shapeless.HNil]]
</span><span style="color:#177500"></span><span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Int</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">String</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">HNil</span><span style="color:#000">]()</span>

<span style="color:#177500">// 编译通过, 生成类型 ::[Int,shapeless.::[String,shapeless.HNil]]
</span><span style="color:#177500"></span><span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Int</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">Boolean</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">String</span> <span style="color:#a90d91">::</span> <span style="color:#a90d91">HNil</span><span style="color:#000">]()</span>
</code></pre></div><p>现在还需要一个<strong>能处理 case class 的 Random 实例</strong>，这个实例会把 case class 转为 HList，然后去调用 Random[HList] 实例。</p>
<p>把 case class 转为 HList 需要借助  Generic.Aux ，那么 case class 的 Random 实例实际上就是组合了 Genric.Aux 和  Random[HList]  两个 Type class 实例，这里就又要用到隐式方法了:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#177500">/**
</span><span style="color:#177500"> * @tparam T   任意 case class
</span><span style="color:#177500"> * @tparam HL  任意 HList 类型
</span><span style="color:#177500"> */</span>
<span style="color:#a90d91">implicit</span> <span style="color:#a90d91">def</span> <span style="color:#000">caseClassRandom</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">HL</span> <span style="color:#a90d91">&lt;:</span> <span style="color:#a90d91">HList</span><span style="color:#000">](</span><span style="color:#a90d91">implicit</span> <span style="color:#000">gen</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Generic.Aux</span><span style="color:#000">[</span><span style="color:#a90d91">T</span>, <span style="color:#a90d91">HL</span><span style="color:#000">],</span> <span style="color:#000">hListRandom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">HL</span><span style="color:#000">])</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#a90d91">new</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">T</span><span style="color:#000">]</span> <span style="color:#000">{</span>
  <span style="color:#a90d91">override</span> <span style="color:#a90d91">def</span> <span style="color:#000">random</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">T</span> <span style="color:#000">=</span> <span style="color:#000">gen</span><span style="color:#000">.</span><span style="color:#000">from</span><span style="color:#000">(</span><span style="color:#000">hListRandom</span><span style="color:#000">.</span><span style="color:#000">random</span><span style="color:#000">())</span>
<span style="color:#000">}</span>
</code></pre></div><p>注：<strong>Generic.Aux[T, HL]</strong> 实例已由 Shapeless 置于隐式作用域内了</p>
<p>这样其实就已经实现了可以处理任意 case class 的 Random 实例了</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Doctor</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">)</span>

<span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">User</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">,</span> <span style="color:#000">name</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">,</span> <span style="color:#000">isCertified</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Boolean</span><span style="color:#000">)</span>

<span style="color:#177500">// 编译通过，输出 User(3489254,48ad1cc8-d529-42f1-9ed2-c710dc1e90a3,false)
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">user</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">User</span><span style="color:#000">]()</span>

<span style="color:#177500">// 编译通过，输出 Doctor(1778276)
</span><span style="color:#177500"></span><span style="color:#a90d91">val</span> <span style="color:#000">doctor</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Random</span><span style="color:#000">[</span><span style="color:#a90d91">Doctor</span><span style="color:#000">]()</span>
</code></pre></div><p>通过下面的图再来理解一下编译器的推导过程，其实很简单</p>
<p><img src="img/Random-deriving.png" alt="image-20200822125522904"> </p>
<h2 id="总结">总结</h2>
<p>整个派生的过程利用了编译器的自动推导，相较于利用反射等其他运行时的技术手段来实现，这样的方式更加的巧妙，并且天然就拥有了类型的静态检查。</p>
<p>但就目前的实现来说有一个不足：无法获取 case class 的 Field 的属性名称。</p>
<p>这在很多场景时非常有必要的，比如如果要实现一个将 case class 格式化为 Json 的 Type class，那么肯定是需要拿到属性名称才能实现的（Scala 的 Spray-JSON 框架就是基于 Type class 实现的）。</p>
<p>好在 Shapeless 提供了 LabelledGeneric 来解决这个问题，限于篇幅，以后有机会再详谈吧。</p>
<p>再多说一句，在 Scala3 中已经提供了原生的 Type class 派生语法了，对比 Shapeless，语言原生的支持肯定更加完备，感兴的可以到<a href="https://dotty.epfl.ch/docs/reference/contextual/derivation.html">官网文档</a>查看。</p>
<h2 id="参考">参考</h2>
<ol>
<li><a href="https://scala.cool/2017/09/shapeless-1/">Shapeless 入门指南（一）：自动派生 typeclass 实例</a>，By Jilen</li>
<li><a href="http://www.dreadedsoftware.com/blog/2017/1/4/simple-generic-derivation-with-shapeless">Simple Generic Derivation with Shapeless</a>，By Marcus Henry</li>
<li><a href="http://gigiigig.github.io/posts/2015/09/13/aux-pattern.html">aux pattern</a>，By Luigi</li>
<li><a href="https://dotty.epfl.ch/docs/reference/contextual/derivation.html">Dotty: Type Class Derivation</a></li>
<li><a href="https://github.com/milessabin/shapeless">Shapeless</a></li>
</ol>

            </section>

            <div class="over">
                <div class="line"></div>
                <span>over</span>
                <div class="line"></div>
            </div>
        </article>
        <div class = "social">

    
        <a href="https://github.com/vran-dev">
            <svg t="1612751476854" class="social-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9196" width="22" height="22">
                <path d="M63.681087 516.285293c0 210.288698 144.593659 387.06044 340.109608 435.411104 8.963443 2.334559 18.979018-5.66029 18.685506-14.948855V740.533933c0-9.954615 5.899616-19.5096 16.818309-25.228593 11.097059-5.5474 8.380932-25.607902-3.738907-28.030515-56.790299-11.356705-105.233532-34.160427-139.233656-64.471315-33.930132-30.367333-53.245562-67.216792-53.245561-106.518217 0-27.359951 9.783022-53.611324 27.084499-77.566521a14.623733 14.623733 0 0 0 2.817728-8.365127v-142.999656l118.721594 63.536587c3.619244 1.971054 8.143864 2.291661 12.088231 0.889571 33.284403-9.868819 69.433946-14.890153 108.385412-14.890153 38.949208 0 75.096494 5.021334 108.385413 14.948856a15.36429 15.36429 0 0 0 12.146933-0.891829l118.662892-63.59529v142.91386a15.115932 15.115932 0 0 0 2.801922 8.42383c17.346633 23.925846 27.098046 50.235922 27.098047 77.564263 0 39.333033-19.268016 76.180235-53.200406 106.547568-34.043022 30.310888-82.5427 53.083-139.278811 64.471315-12.115324 2.363911-14.77049 22.42667-3.73665 27.971813 10.923209 5.723508 16.822825 15.240111 16.822825 25.23085v196.215867c-0.295771 9.28405 9.749156 17.281157 18.685505 14.948855C816.104564 903.343476 960.668872 726.517546 960.668872 516.285293c0-247.50392-201.00239-448.495021-448.492764-448.495021-247.50392 0-448.495021 200.991101-448.495021 448.495021z m448.495021-418.595052c231.37198 0 418.590537 187.236619 418.590537 418.595052 0 189.266376-126.779662 345.246091-298.995176 397.046664v-172.800282c0-11.970825-4.610416-22.60052-11.209949-31.769422 49.723403-13.666429 95.127645-35.156114 127.946942-64.471315 38.922115-34.600697 62.660564-78.952807 62.660564-128.005645 0-32.381285-11.794717-62.003545-29.897711-88.808078v-165.336015c0.085796-10.469392-13.314213-18.322-22.428928-13.068113l-137.34614 73.755365c-34.108498-9.254699-70.578648-15.840684-109.320139-15.840685-38.718913 0-75.277118 6.525025-109.322397 15.840685l-137.352913-73.726013c-9.094395-5.253887-22.510209 2.598721-22.424412 13.068113v165.336014c-18.116541 26.806791-29.899969 56.429051-29.899969 88.808079 0 49.025744 23.7678 93.375596 62.617665 127.978551 32.878 29.373903 78.32514 50.804886 127.962747 64.532275-6.572439 9.137293-11.185113 19.737637-11.185113 31.737813v50.482022c-32.584486 12.149191-54.015469 14.718561-67.275495 12.149191-14.291838-2.829016-21.999947-10.189425-30.787282-22.426671-17.70788-24.646082-35.083865-69.989364-92.546986-84.820814-19.547983-5.222278-26.161062 23.912299-7.475557 28.996852 45.081378 11.67957 53.972571 43.329329 75.638365 73.579256 10.889342 15.068519 26.497473 29.084905 49.578904 33.636619 19.227376 3.736649 42.498461 0.878282 72.863535-9.372104v90.600767c-172.156811-51.825409-298.995176-207.834475-298.995175-397.100851 0.009031-231.360691 187.24565-418.59731 418.604083-418.59731z" fill="#707070" p-id="9197"></path>
            </svg>  
        </a>
    

    
        <a href='#'>
            <svg t="1612751098681" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16516" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="16517"></path><path d="M792.845583 353.808158a119.106898 119.106898 0 0 0 8.717476-20.532369 17.083697 17.083697 0 0 0-24.939005-19.893726 192.646626 192.646626 0 0 1-52.560309 21.490333 122.332044 122.332044 0 0 0-81.810154-31.517026 121.980791 121.980791 0 0 0-121.789198 126.866409 281.673444 281.673444 0 0 1-183.130847-101.480355 17.115629 17.115629 0 0 0-27.972558 2.235251 121.757266 121.757266 0 0 0-2.107522 118.819508 20.053387 20.053387 0 0 0-6.833478 2.490707 18.233254 18.233254 0 0 0-8.430087 15.359362c0 36.242984 16.125733 69.516278 42.118499 92.124236l-1.117625 1.117625a17.051765 17.051765 0 0 0-3.448672 16.54085 121.853062 121.853062 0 0 0 69.739803 75.519521 195.871772 195.871772 0 0 1-108.760883 18.488712 17.403019 17.403019 0 0 0-18.073594 11.240115 17.115629 17.115629 0 0 0 6.865411 20.117251 314.244231 314.244231 0 0 0 169.847075 49.782212c197.340651 0 315.297992-160.299364 315.297992-315.266059l-0.031932-5.236872a227.420731 227.420731 0 0 0 49.207434-53.007359 17.083697 17.083697 0 0 0-20.787826-25.258326z m-55.721591 56.040913a17.083697 17.083697 0 0 0-7.088936 14.720718c0.191593 4.215043 0.287389 8.49395 0.287389 12.708994 0 138.20232-105.152551 281.16253-281.130598 281.162529a279.725583 279.725583 0 0 1-92.1881-15.582886 225.856056 225.856056 0 0 0 97.233379-44.385681 17.083697 17.083697 0 0 0-10.218286-30.495197 87.877261 87.877261 0 0 1-70.059124-37.105152c8.078832-0.542846 15.998004-1.883997 23.693651-3.959586a17.051765 17.051765 0 0 0-1.149558-33.20943 87.526007 87.526007 0 0 1-66.450792-60.830734c8.49395 2.139454 17.211426 3.384807 25.928901 3.672196 7.504054-0.031932 14.465261-4.630161 16.796308-11.846825s-0.415118-15.167768-6.769614-19.382812a87.685668 87.685668 0 0 1-36.498441-94.040164 315.585381 315.585381 0 0 0 209.730323 94.902332c5.620057 0.031932 10.537608-1.979793 13.954347-6.099039s4.725957-9.579643 3.512536-14.816515a87.813397 87.813397 0 0 1 149.506299-80.021954 17.083697 17.083697 0 0 0 15.774479 5.077211c5.268804-1.053761 10.473743-2.267182 15.614819-3.672196a81.043782 81.043782 0 0 1-7.216665 4.821753 17.083697 17.083697 0 0 0 10.793065 31.548959l5.81165-0.734439a178.979668 178.979668 0 0 1-9.867032 7.567918z" fill="#828282" p-id="16518"></path>
            </svg>
        </a>
    

    
        <a href='#' >
            <svg t="1612751005803" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13371" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="13372"></path><path d="M623.796812 224.610702h-85.194961C430.096425 223.525009 416.237875 290.678309 416.237875 363.355869V416.203567h-47.898217a14.209804 14.209804 0 0 0-15.966072 15.966073v95.796432a14.209804 14.209804 0 0 0 15.966072 15.966072H416.237875v239.491082a14.337533 14.337533 0 0 0 16.061868 15.966072h97.552701c9.419983 1.085693 17.051765-6.54609 14.050143-15.966072L543.966451 543.932144h79.830361a14.209804 14.209804 0 0 0 15.966072-15.966072v-95.796432a14.209804 14.209804 0 0 0-15.966072-15.966073h-79.926157L543.966451 368.305351c3.097418-20.40464 3.097418-17.083697 22.03318-15.966072h57.126606c4.438568-0.989896 9.164525-0.44705 12.485468-3.672197 3.320943-3.225147 5.236872-7.631782 4.119247-12.293875v-95.796433A14.177872 14.177872 0 0 0 623.796812 224.610702z m-17.083697 94.008233l-40.042909-1.532743c-49.59062 0-53.741799 26.918798-53.741799 54.476238l-0.127728 60.543345a17.051765 17.051765 0 0 0 17.051765 17.083697H607.83074v61.692903h-77.914432a17.083697 17.083697 0 0 0-17.083697 17.051765L512.800679 767.457154H448.170019v-239.491082c0-9.419983-6.418361-17.051765-15.870276-17.051765H384.30573v-61.692902h47.994013a17.051765 17.051765 0 0 0 12.070351-4.981415c3.193214-3.225147 3.767993-7.567918 3.767993-12.102283v-68.81377c0-71.591867 14.465261-105.695397 90.431832-105.695398h68.111263v60.990396z" fill="#828282" p-id="13373"></path>
            </svg>
        </a>
    
</div>
        
        
        <div>
            <script src="https://utteranc.es/client.js"
repo='vran-dev/vran-dev.github.io'
issue-term="pathname"
label="Comment"
theme="github-light"
crossorigin="anonymous"
async>

</script>
        </div>
        

    </section>

    <footer id="footer">
    <p>
        
        © 2021 <i></i> vran
        
        ∘ Powered by <a href="http://www.gohugo.io/">Hugo</a>  ∘  Theme <a href="https://github.com/vran-dev/ZenHo">ZenHo</a>
    </p>
</footer>


</body>
