<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

		
		<meta name="google-site-verification" content="WQzn_X1rrhY2HHCuTYlY750m0YcuY3H73Z3T-OFsDOM" />
        

		<meta name="author" content="vran">
		
		<meta name="generator" content="Hugo 0.106.0">
		<title>纵享丝滑，Mybatis-Dynamic-Sql 集成体验 &middot; 且徐行</title>
		<link rel="shortcut icon" href="https://blog.cc1234.cc/images/favicon.ico">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/style.css">
        <link rel="stylesheet" href="https://blog.cc1234.cc/css/highlight.css">
</head>


<body>
    <section id="single" class="wrapper">
    <nav class="nav-main" style="display: flex;">
         <div style="margin-left:auto;">
            
            <a href='https://blog.cc1234.cc/'> Home</a>
            <a href='https://blog.cc1234.cc/posts'>Archive</a> 
            <a href='https://blog.cc1234.cc/tags'>Tags</a> 
            <a href='https://blog.cc1234.cc/about'>About</a>
   
           
         </div>
</nav>

        <article class = "post">
            <header>
                <div class = "post-img">
                    <img src='img/mybatis-icon.jpg' alt="" />
                </div>
                <div class = "title" >
                    纵享丝滑，Mybatis-Dynamic-Sql 集成体验
                </div>
                <div class="meta">
                2021/09/02
                · vran
                </div>
            </header>
            <div class = "line"></div>
            
            <section class="content">
                <h2 id="前言">前言</h2>
<p>我大概两三年没有使用过 Mybatis 了，最近因为项目的原因重新开始使用 Mybatis，体验上总感觉不丝滑，即使加了 Mybatis plus 也没有达到我心中的预期。</p>
<p>回想这几年用的 <a href="https://www.jooq.org/">JOOQ</a>，直接用 Java 写 SQL 的体验太棒了。它实现的 DSL 完备度很高，几乎和写原生的 SQL 体验差不多了。</p>
<p>那 mybatis 生态有没有类似于这样的框架呢？还真巧了，官方还真就有一个叫 Mybatis-dynamic-SQL 项目。而本文是记录我在集成 Mybatis dynamic SQL、Mybatis Generator 时的一些历程。</p>
<p>整个项目我已经放在 Github （<a href="https://github.com/vran-dev/mybatis-dynamic-sql-integration-demo">Mybatis-Dynamic-SQL-integration-demo</a>） ，如果你感兴趣可以点个 star，我会持续更新。</p>
<h2 id="观察维度">观察维度</h2>
<p>在开始实际写代码体验之前，我列了四个维度来观察框架是否能符合自己的期望，它们分别是</p>
<ol>
<li>Mybatis 生态兼容性</li>
<li>代码生成能力</li>
<li>无 XML</li>
<li>DSL 完备度</li>
</ol>
<p>下面一个一个来过一下</p>
<p><strong>一、Mybatis 生态兼容性</strong></p>
<p>就是要和 Mybatis 既有的生态保持兼容性，比如一些 SQL 日志插件、分页查询插件以及通用的 TypeHandler，二级缓存等</p>
<p><strong>二、代码生成能力</strong></p>
<p>数据库实体可以自动生成，开发者不需要（通常也不允许）修改这一部分自动生成的代码，但开发者可以通过配置项来灵活的制定生成规则以便扩展。</p>
<p>要是代码生成工具能和构建工具（比如 Maven、Gradle）无缝集成那就更好。</p>
<p><strong>三、无 XML</strong></p>
<p>零 XML</p>
<p><strong>四、DSL 完备度</strong>（Domain Special Language）</p>
<p>既然是用 Java 的方式来写 SQL，那框架就得对常用的 SQL 有完善的支持，对不常用的 SQL 也能有相应的解决方案。</p>
<p>还有一个点就是写出来的 DSL 和原生 SQL 的差别不能太大，类似于下面这样，几乎一眼就能看懂</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UserRepository</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">User</span> <span style="color:#000">selectByUsernameAndPassword</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">username</span><span style="color:#000">,</span> <span style="color:#000">String</span> <span style="color:#000">password</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Tables</span><span style="color:#000">.</span><span style="color:#836c28">User</span> <span style="color:#000">user</span> <span style="color:#000">=</span> <span style="color:#000">Tables</span><span style="color:#000">.</span><span style="color:#836c28">user</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// select * from user where user.name = ? and user.password = ?
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">return</span> <span style="color:#000">select</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">all</span><span style="color:#000">()).</span><span style="color:#836c28">from</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">.</span><span style="color:#836c28">where</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">username</span><span style="color:#000">().</span><span style="color:#836c28">eq</span><span style="color:#000">(</span><span style="color:#000">username</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">.</span><span style="color:#836c28">and</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">password</span><span style="color:#000">().</span><span style="color:#836c28">eq</span><span style="color:#000">(</span><span style="color:#000">password</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><h2 id="框架简介">框架简介</h2>
<h3 id="mybatis-dynamic-sql"><strong>Mybatis Dynamic SQL</strong></h3>
<p><a href="https://mybatis.org/mybatis-dynamic-sql/docs/introduction.html">Mybatis Dynamic SQL</a> 是  Mybatis 团队出的一个框架，兼容 Mybatis3 的生态，但与 Mybatis 最大的不同是：你既不用在 XML 里写 SQL，也不用在 Annotation 里拼接 SQL（用 Java 拼接过复杂字符串的都懂），而是直接以 Java 的方式去写 SQL。</p>
<p>这样会带来以下好处</p>
<ul>
<li>Typesafe：在编译期就可以确保你的 sql 参数类型和列类型是一致的</li>
<li>Expressive：这就是要执行的 SQL 的样子</li>
<li>Flexible：再复杂的 if else、and、or 都能轻松实现</li>
</ul>
<h3 id="mybatis-generator"><strong>Mybatis Generator</strong></h3>
<p><a href="https://mybatis.org/generator/">Mybatis Generator</a> 也是 Mybatis 团队出的代码自动生成工具，它支持 Mybatis3、Mybatis-Dynamic-SQL 等类型的代码生成。提供了非常多的扩展点和预定义配置项，使得用户可以灵活的自定义生成规则。</p>
<p>并且 Generator 也支持多种生成模式，用户可以根据使用场景自行选择</p>
<ul>
<li>command 模式：可以通过命令行生成代码</li>
<li>Maven 插件：直接集成在 Maven 构建工具中</li>
<li>Java Runtime 模式：通过编写 Java 代码然后运行来生成</li>
<li>&hellip;&hellip;</li>
</ul>
<h2 id="业务集成">业务集成</h2>
<p>接下来就是将这一套框架应用在实际的业务开发场景中去了，看一下是否能够符合我的期望。</p>
<h3 id="业务模拟"><strong>业务模拟</strong></h3>
<p>我模拟了一个用户、订单相关的业务场景，完整覆盖了增删改查的应用，整个用例如下</p>
<p><img src="img/use-case.png" alt="Untitled"></p>
<p>数据模型对应了三张表：user、order、order_item，参考下面的 UML</p>
<p><img src="img/use-uml.png" alt="Untitled"></p>
<p>完整的 SQL 请通过 GITHUB 查看：<a href="https://github.com/vran-dev/mybatis-dynamic-sql-integration-demo/blob/main/api/src/main/resources/db/migration/V1__init.sql">V1__init.sql</a></p>
<h3 id="项目构建"><strong>项目构建</strong></h3>
<p>项目我使用了 Gradle 来构建，引入了 Lombok、Mapstruct 等基于 APT 的代码生成工具。</p>
<p>完整的构建环境和依赖库如下所示</p>
<p><img src="img/project-build.png" alt="Untitled"></p>
<p>整个项目分了 3 个 module，module 之间的依赖关系如下</p>
<p><img src="img/project-module.png" alt="Untitled"></p>
<p>每个 module 内部的包如下</p>
<p><img src="img/project-module2.png" alt="Untitled"></p>
<ul>
<li>API</li>
</ul>
<p>该模块提供 http 端口给客户端，它会依赖 Core 和 Dao 模块</p>
<ul>
<li>CORE</li>
</ul>
<p>实现了具体的业务逻辑，不依赖任何 module</p>
<ul>
<li>DAO</li>
</ul>
<p>由 Mybatis 生成的 Mapper、Entity 都会存放在该 Module 下，并且该 Dao 模块内会实现 Core 模块内的 Repository，所以它会依赖 Core 模块</p>
<h3 id="将-mybatis-generator-集成进-gradle-task">将 Mybatis Generator 集成进 Gradle Task</h3>
<p>Mybatis Generator 目前没有官方的 Gradle Plugin 可以集成，但是万能的开源社区却为我们提供了这样的一个 插件</p>
<blockquote>
<p>Mybatis-Generator-Plugin (<a href="https://github.com/kimichen13/mybatis-generator-plugin">https://github.com/kimichen13/mybatis-generator-plugin</a>)</p>
</blockquote>
<p>集成方式也很简单，完整配置可参考 <a href="https://github.com/vran-dev/mybatis-dynamic-sql-integration-demo/blob/main/dao/build.gradle">dao/build.gradle</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#000">plugins</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">id</span> <span style="color:#c41a16">&#39;java-library&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">id</span> <span style="color:#c41a16">&#34;com.thinkimi.gradle.MybatisGenerator&#34;</span> <span style="color:#000">version</span> <span style="color:#c41a16">&#34;2.3&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">mybatisGenerator</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">verbose</span> <span style="color:#000">=</span> <span style="color:#a90d91">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">configFile</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#39;src/main/resources/generatorConfiguration.xml&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dependencies</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">mybatisGenerator</span>  <span style="color:#000">group:</span> <span style="color:#c41a16">&#39;org.mybatis.generator&#39;</span><span style="color:#000">,</span> <span style="color:#000">name:</span> <span style="color:#c41a16">&#39;mybatis-generator-core&#39;</span><span style="color:#000">,</span> <span style="color:#000">version:</span> <span style="color:#c41a16">&#39;1.4.0&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">mybatisGenerator</span> <span style="color:#000">group:</span> <span style="color:#c41a16">&#39;mysql&#39;</span><span style="color:#000">,</span> <span style="color:#000">name:</span> <span style="color:#c41a16">&#39;mysql-connector-java&#39;</span><span style="color:#000">,</span> <span style="color:#000">version:</span> <span style="color:#c41a16">&#39;8.0.25&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// you can add jdbc driver here
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>代码的生成规则都放在 <code>generatorConfiguration.xml</code> 配置文件中（关于 Mybatis generator 的更多配置可以参考<a href="https://mybatis.org/generator/configreference/xmlconfig.html">官方文档</a> ）。</p>
<p>一定记得在 context 标签中配置  <code>targetRuntime=&quot;MyBatis3DynamicSql&quot;</code> ，这样才能生成 mybatis dynamic sql 框架需要的代码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#633820">&lt;!DOCTYPE generatorConfiguration PUBLIC
</span></span></span><span style="display:flex;"><span><span style="color:#633820">        &#34;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#633820">        &#34;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;generatorConfiguration&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">&lt;!-- MyBatis3DynamicSql 指定生成 mybatis dynamic sql 的代码 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;context</span> <span style="color:#836c28">id=</span><span style="color:#c41a16">&#34;dsql&#34;</span> <span style="color:#836c28">targetRuntime=</span><span style="color:#c41a16">&#34;MyBatis3DynamicSql&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 转义规则 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;autoDelimitKeywords&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;true&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;beginningDelimiter&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;`&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;endingDelimiter&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;`&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 数据库连接 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;jdbcConnection</span> <span style="color:#836c28">driverClass=</span><span style="color:#c41a16">&#34;com.mysql.cj.jdbc.Driver&#34;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#836c28">connectionURL=</span><span style="color:#c41a16">&#34;jdbc:mysql://localhost:3306/user&#34;</span> <span style="color:#836c28">userId=</span><span style="color:#c41a16">&#34;root&#34;</span> <span style="color:#836c28">password=</span><span style="color:#c41a16">&#34;123456&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- mybatis type handler --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;javaTypeResolver&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;useJSR310Types&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;true&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/javaTypeResolver&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">&lt;!-- 代码生成存放路径 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;javaModelGenerator</span> <span style="color:#836c28">targetPackage=</span><span style="color:#c41a16">&#34;cc.cc1234.dao.model&#34;</span> <span style="color:#836c28">targetProject=</span><span style="color:#c41a16">&#34;src/main/java&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;javaClientGenerator</span> <span style="color:#836c28">targetPackage=</span><span style="color:#c41a16">&#34;cc.cc1234.dao.mapper&#34;</span> <span style="color:#836c28">targetProject=</span><span style="color:#c41a16">&#34;src/main/java&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>						<span style="color:#177500">&lt;!-- 为生成的 Mapper 指定父接口 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;property</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;rootInterface&#34;</span> <span style="color:#836c28">value=</span><span style="color:#c41a16">&#34;org.mybatis.dynamic.sql.util.mybatis3.CommonSelectMapper&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/javaClientGenerator&gt;</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>				<span style="color:#177500">&lt;!-- 表和实体的生成规则映射 --&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">&lt;table</span> <span style="color:#836c28">tableName=</span><span style="color:#c41a16">&#34;user&#34;</span> <span style="color:#836c28">domainObjectName=</span><span style="color:#c41a16">&#34;UserEntity&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">&lt;generatedKey</span> <span style="color:#836c28">column=</span><span style="color:#c41a16">&#34;id&#34;</span> <span style="color:#836c28">sqlStatement=</span><span style="color:#c41a16">&#34;JDBC&#34;</span> <span style="color:#836c28">identity=</span><span style="color:#c41a16">&#34;true&#34;</span> <span style="color:#836c28">type=</span><span style="color:#c41a16">&#34;post&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">&lt;!-- Gender 字段使用自定义的 typeHandler 处理 --&gt;</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">&lt;columnOverride</span> <span style="color:#836c28">column=</span><span style="color:#c41a16">&#34;gender&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#836c28">javaType=</span><span style="color:#c41a16">&#34;cc.cc1234.core.domain.enums.Gender&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#836c28">typeHandler=</span><span style="color:#c41a16">&#34;org.apache.ibatis.type.EnumOrdinalTypeHandler&#34;</span><span style="color:#000">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">&lt;/table&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/context&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/generatorConfiguration&gt;</span>
</span></span></code></pre></div><p>这样配置完成以后只需要执行 <code>mbGenerator</code> 这个 task 就可以生成代码了，如果你使用的是 Intellij IDEA 的话，可以在右侧工具栏找到该 task</p>
<p><img src="img/generator-task.png" alt="Untitled"></p>
<p>执行玩 task 以后你就能在项目里看见你生成的代码了</p>
<p><img src="img/generator-code.png" alt="Untitled"></p>
<h3 id="生成的代码分析和使用">生成的代码分析和使用</h3>
<p>生成的代码主要包括 xxxMapper、xxxSqlSupport 和 xxxEntity。</p>
<ul>
<li>Entity 就是数据库表对应的 Java 实体，仅有 Getter 和 Setter</li>
<li>Mapper 则是执行 CRUD 的入口，默认已经有了通用的 CRUD 方法</li>
<li>SqlSupport 则是维护了实体和表的映射关系，比如某个 Field 对应表的某一列</li>
</ul>
<p>完整的项目我已经开源在了 <a href="https://github.com/vran-dev/mybatis-dynamic-sql-integration-demo">GITHUB </a>，你随时可以 fork 下来运行，我这里就只展示部分代码了，</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UserEntityDynamicSqlSupport</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Generated</span><span style="color:#000">(</span><span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;org.mybatis.generator.api.MyBatisGenerator&#34;</span><span style="color:#000">,</span> <span style="color:#000">date</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;2021-08-29T21:59:12.7120396+08:00&#34;</span><span style="color:#000">,</span> <span style="color:#000">comments</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Source Table: user&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">UserEntity</span> <span style="color:#000">userEntity</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">UserEntity</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Generated</span><span style="color:#000">(</span><span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;org.mybatis.generator.api.MyBatisGenerator&#34;</span><span style="color:#000">,</span> <span style="color:#000">date</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;2021-08-29T21:59:12.7120949+08:00&#34;</span><span style="color:#000">,</span> <span style="color:#000">comments</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Source field: user.id&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">Long</span><span style="color:#000">&gt;</span> <span style="color:#000">id</span> <span style="color:#000">=</span> <span style="color:#000">userEntity</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Generated</span><span style="color:#000">(</span><span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;org.mybatis.generator.api.MyBatisGenerator&#34;</span><span style="color:#000">,</span> <span style="color:#000">date</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;2021-08-29T21:59:12.7120949+08:00&#34;</span><span style="color:#000">,</span> <span style="color:#000">comments</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Source field: user.username&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">String</span><span style="color:#000">&gt;</span> <span style="color:#000">username</span> <span style="color:#000">=</span> <span style="color:#000">userEntity</span><span style="color:#000">.</span><span style="color:#836c28">username</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Generated</span><span style="color:#000">(</span><span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;org.mybatis.generator.api.MyBatisGenerator&#34;</span><span style="color:#000">,</span> <span style="color:#000">date</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;2021-08-29T21:59:12.7120949+08:00&#34;</span><span style="color:#000">,</span> <span style="color:#000">comments</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Source field: user.gender&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">Gender</span><span style="color:#000">&gt;</span> <span style="color:#000">gender</span> <span style="color:#000">=</span> <span style="color:#000">userEntity</span><span style="color:#000">.</span><span style="color:#836c28">gender</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Generated</span><span style="color:#000">(</span><span style="color:#000">value</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;org.mybatis.generator.api.MyBatisGenerator&#34;</span><span style="color:#000">,</span> <span style="color:#000">date</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;2021-08-29T21:59:12.7120949+08:00&#34;</span><span style="color:#000">,</span> <span style="color:#000">comments</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Source Table: user&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UserEntity</span> <span style="color:#a90d91">extends</span> <span style="color:#000">SqlTable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">Long</span><span style="color:#000">&gt;</span> <span style="color:#000">id</span> <span style="color:#000">=</span> <span style="color:#000">column</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;id&#34;</span><span style="color:#000">,</span> <span style="color:#000">JDBCType</span><span style="color:#000">.</span><span style="color:#836c28">BIGINT</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">String</span><span style="color:#000">&gt;</span> <span style="color:#000">username</span> <span style="color:#000">=</span> <span style="color:#000">column</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;username&#34;</span><span style="color:#000">,</span> <span style="color:#000">JDBCType</span><span style="color:#000">.</span><span style="color:#836c28">VARCHAR</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#000">SqlColumn</span><span style="color:#000">&lt;</span><span style="color:#000">Gender</span><span style="color:#000">&gt;</span> <span style="color:#000">gender</span> <span style="color:#000">=</span> <span style="color:#000">column</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;gender&#34;</span><span style="color:#000">,</span> <span style="color:#000">JDBCType</span><span style="color:#000">.</span><span style="color:#836c28">TINYINT</span><span style="color:#000">,</span> <span style="color:#c41a16">&#34;cc.cc1234.dao.EnumOrdinalTypeHandler&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">public</span> <span style="color:#000">UserEntity</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">super</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;user&#34;</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>那么如何用这些生成的代码来构造 SQL 查询呢</p>
<p>对于简单的 CRUD，使用起来是非常简单的</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">private</span> <span style="color:#000">UserEntityMapper</span> <span style="color:#000">userEntityMapper</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Optional</span><span style="color:#000">&lt;</span><span style="color:#000">User</span><span style="color:#000">&gt;</span> <span style="color:#000">selectByPrimaryKey</span><span style="color:#000">(</span><span style="color:#000">Long</span> <span style="color:#000">id</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">userEntityMapper</span><span style="color:#000">.</span><span style="color:#836c28">selectByPrimaryKey</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">Long</span> <span style="color:#000">insertAndReturnPrimaryKey</span><span style="color:#000">(</span><span style="color:#000">User</span> <span style="color:#000">user</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">final</span> <span style="color:#000">UserEntity</span> <span style="color:#000">entity</span> <span style="color:#000">=</span> <span style="color:#000">userRecordConverter</span><span style="color:#000">.</span><span style="color:#836c28">from</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">userEntityMapper</span><span style="color:#000">.</span><span style="color:#836c28">insertSelective</span><span style="color:#000">(</span><span style="color:#000">entity</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">entity</span><span style="color:#000">.</span><span style="color:#836c28">getId</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">deleteByPrimaryKey</span><span style="color:#000">(</span><span style="color:#000">Long</span> <span style="color:#000">id</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">int</span> <span style="color:#000">delete</span> <span style="color:#000">=</span> <span style="color:#000">userEntityMapper</span><span style="color:#000">.</span><span style="color:#836c28">delete</span><span style="color:#000">(</span><span style="color:#000">d</span> <span style="color:#000">-&gt;</span> <span style="color:#000">d</span><span style="color:#000">.</span><span style="color:#836c28">where</span><span style="color:#000">(</span><span style="color:#000">UserEntityDynamicSqlSupport</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">,</span> <span style="color:#000">isEqualTo</span><span style="color:#000">(</span><span style="color:#000">id</span><span style="color:#000">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">delete</span> <span style="color:#000">==</span> <span style="color:#000">1</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">updateByPrimaryKey</span><span style="color:#000">(</span><span style="color:#000">User</span> <span style="color:#000">userEntity</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000">record</span> <span style="color:#000">=</span> <span style="color:#000">userRecordConverter</span><span style="color:#000">.</span><span style="color:#836c28">from</span><span style="color:#000">(</span><span style="color:#000">userEntity</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#000">userEntityMapper</span><span style="color:#000">.</span><span style="color:#836c28">updateByPrimaryKeySelective</span><span style="color:#000">(</span><span style="color:#000">record</span><span style="color:#000">)</span> <span style="color:#000">==</span> <span style="color:#000">1</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><p>即使是复杂的查询和类型映射也不难，写出来的感觉和原生 SQL 差距不会很大，基本上一眼就能看懂。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * &lt;pre&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     *     select user.id, order_item.goods_name, sum(order_item.goods_quantity) from user
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     *      inner join `order` on user.id = `order`.user_id
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     *      inner join order_item on `order`.id = order_item.order_id
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     *      where user.id = 1 group by order_item.goods_name
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * &lt;/pre&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     *
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param userId
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">UserPurchasedGoods</span><span style="color:#000">&gt;</span> <span style="color:#000">selectUserPurchasedOrders</span><span style="color:#000">(</span><span style="color:#000">Long</span> <span style="color:#000">userId</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// alias
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#000">val</span> <span style="color:#000">user</span> <span style="color:#000">=</span> <span style="color:#000">UserEntityDynamicSqlSupport</span><span style="color:#000">.</span><span style="color:#836c28">userEntity</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#000">orderItem</span> <span style="color:#000">=</span> <span style="color:#000">OrderItemEntityDynamicSqlSupport</span><span style="color:#000">.</span><span style="color:#836c28">orderItemEntity</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#000">order</span> <span style="color:#000">=</span> <span style="color:#000">OrderEntityDynamicSqlSupport</span><span style="color:#000">.</span><span style="color:#836c28">orderEntity</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// build sql dsl
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#000">val</span> <span style="color:#000">sqlDsl</span> <span style="color:#000">=</span> <span style="color:#000">select</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">,</span> <span style="color:#000">orderItem</span><span style="color:#000">.</span><span style="color:#836c28">goodsName</span><span style="color:#000">,</span> <span style="color:#000">sum</span><span style="color:#000">(</span><span style="color:#000">orderItem</span><span style="color:#000">.</span><span style="color:#836c28">goodsQuantity</span><span style="color:#000">).</span><span style="color:#836c28">as</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;goods_quantity&#34;</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">from</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">join</span><span style="color:#000">(</span><span style="color:#000">order</span><span style="color:#000">).</span><span style="color:#836c28">on</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">,</span> <span style="color:#000">equalTo</span><span style="color:#000">(</span><span style="color:#000">order</span><span style="color:#000">.</span><span style="color:#836c28">userId</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">join</span><span style="color:#000">(</span><span style="color:#000">orderItem</span><span style="color:#000">).</span><span style="color:#836c28">on</span><span style="color:#000">(</span><span style="color:#000">order</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">,</span> <span style="color:#000">equalTo</span><span style="color:#000">(</span><span style="color:#000">orderItem</span><span style="color:#000">.</span><span style="color:#836c28">orderId</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">where</span><span style="color:#000">(</span><span style="color:#000">user</span><span style="color:#000">.</span><span style="color:#836c28">id</span><span style="color:#000">,</span> <span style="color:#000">isEqualTo</span><span style="color:#000">(</span><span style="color:#000">userId</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">groupBy</span><span style="color:#000">(</span><span style="color:#000">orderItem</span><span style="color:#000">.</span><span style="color:#836c28">goodsName</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">build</span><span style="color:#000">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">.</span><span style="color:#836c28">render</span><span style="color:#000">(</span><span style="color:#000">RenderingStrategies</span><span style="color:#000">.</span><span style="color:#836c28">MYBATIS3</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// execute and map
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#a90d91">return</span> <span style="color:#000">userEntityMapper</span><span style="color:#000">.</span><span style="color:#836c28">selectMany</span><span style="color:#000">(</span><span style="color:#000">sqlDsl</span><span style="color:#000">,</span> <span style="color:#000">map</span> <span style="color:#000">-&gt;</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">val</span> <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">UserPurchasedGoods</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#836c28">setGoodsQuantity</span><span style="color:#000">(</span><span style="color:#000">Integer</span><span style="color:#000">.</span><span style="color:#836c28">parseInt</span><span style="color:#000">(</span><span style="color:#000">map</span><span style="color:#000">.</span><span style="color:#836c28">get</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;goods_quantity&#34;</span><span style="color:#000">).</span><span style="color:#836c28">toString</span><span style="color:#000">()));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#836c28">setGoodsName</span><span style="color:#000">(</span><span style="color:#000">map</span><span style="color:#000">.</span><span style="color:#836c28">get</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;goods_name&#34;</span><span style="color:#000">).</span><span style="color:#836c28">toString</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#000">result</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">});</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><h3 id="不支持的-sql">不支持的 SQL</h3>
<p>在验证过程中发现 Mybatis Dynamic SQL 有一些 SQL 是没有封装进 DSL 里面的（即存在对应的链式调用方法），比如</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a90d91">INSERT</span> <span style="color:#a90d91">INTO</span> ...... <span style="color:#a90d91">ON</span> <span style="color:#000">DUPLICATE</span> <span style="color:#a90d91">KEY</span> <span style="color:#a90d91">UPDATE</span>...
</span></span></code></pre></div><p>或者</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a90d91">INSERT</span> <span style="color:#a90d91">IGNORE</span> <span style="color:#a90d91">INTO</span>...
</span></span></code></pre></div><p>官方也有对应的 issue （<a href="https://github.com/mybatis/mybatis-dynamic-sql/issues/82">https://github.com/mybatis/mybatis-dynamic-sql/issues/82</a>），不过好在虽然 DSL 不支持，但是却可以通过 Mybatis 原生的 @Insert 注解来写这样的原生 SQL，这就需要继承由 Mybatis Generator 生成的 Mapper 了。</p>
<p>由于很多 DB 实现的 SQL 语法都不统一，所以在业务中遇见这种情况还是蛮常见的，好在 Mybatis Dynamic SQL 兼容 Mybatis 的注解功能，那几乎都能通过写原生 SQL 的方式来解决这样的问题。</p>
<h3 id="一个-bug">一个 Bug</h3>
<p>我在做 Demo 的时候无意间还碰到了一个 bug，我使用了Mybatis 自带的 <code>EnumOrdinalTypeHandler</code> 来处理枚举类型字段的读和写，结果发现在涉及 Inserrt 或 Update 语句时该 Handler 无法正确的处理并且会抛出异常。</p>
<p>最后通过 debug 发现这是一个小 bug，已经通过 issue （<a href="https://github.com/mybatis/mybatis-dynamic-sql/issues/391">https://github.com/mybatis/mybatis-dynamic-sql/issues/391</a>）的形式反馈给了官方团队，官方也做出了回馈。</p>
<p>要解决这个问题，除了 mybatis dynamic sql 需要改以外，mybatis generator 也需要改，而后者的 release 周期要长一些。</p>
<p>如果你有兴趣的话，可以持续关注。</p>
<h2 id="总结"><strong>总结</strong></h2>
<p>最后再从自己定的几个考察维度来做一个总结吧</p>
<table>
<thead>
<tr>
<th>观察维度</th>
<th>星级</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mybatis 生态兼容性</td>
<td>☆☆☆☆☆</td>
<td>几乎兼容 mybatis 现有插件，而且学习成本低</td>
</tr>
<tr>
<td>代码生成能力</td>
<td>☆☆☆☆</td>
<td>配置项还无法完全覆盖 mybatis 支持的特性，但它的扩展能力很强，可以通过扩展的方式实现</td>
</tr>
<tr>
<td>无 XML</td>
<td>☆☆☆☆☆</td>
<td>完全可以做到</td>
</tr>
<tr>
<td>DSL 完备性</td>
<td>☆☆☆</td>
<td>很多 SQL 还是不支持，对比 JOOQ 的话，这方面相形见绌</td>
</tr>
<tr>
<td>社区活跃度</td>
<td>☆☆☆</td>
<td>Mybatis dynamicc sql 使用的人不多，但是官方一直在保持更新。 Mybatis generator 更新的频次倒不是很活跃。</td>
</tr>
</tbody>
</table>
<p>整体体验下来的话我觉得在生产环境中引入 Mybatis Dynamic SQL 是可行的，在引入之前只需要考虑清楚：在某段时间内项目的 SQL 真的需要和代码分离吗？</p>
<p>选择的本质还是在做 trade off。</p>
<p>如果你也无法忍受 mybatis 的 xml 和注解，但又必须使用 mybatis 生态，那 mybatis dynamic sql 或许就是你的不二选择。</p>
<p>如果你不介意是否是 mybatis 生态，那其实我更建议你使用 JOOQ，它的 DSL 更完备，配套的代码生成能力也更强大。</p>
<h2 id="相关链接"><strong>相关链接</strong></h2>
<ol>
<li><a href="https://github.com/vran-dev/mybatis-dynamic-sql-integration-demo">Mybatis-Dynamic-SQL-Integeration-demo</a></li>
<li><a href="https://mybatis.org/generator/index.html">Mybatis Generator docs</a></li>
<li><a href="https://mybatis.org/mybatis-dynamic-sql/docs/introduction.html">Myabtis Dynamic SQL docs</a></li>
</ol>

            </section>

            <div class="over">
                <div class="line"></div>
                <span>over</span>
                <div class="line"></div>
            </div>
        </article>
        <div class = "social">

    
        <a href="https://github.com/vran-dev">
            <svg t="1612751476854" class="social-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9196" width="22" height="22">
                <path d="M63.681087 516.285293c0 210.288698 144.593659 387.06044 340.109608 435.411104 8.963443 2.334559 18.979018-5.66029 18.685506-14.948855V740.533933c0-9.954615 5.899616-19.5096 16.818309-25.228593 11.097059-5.5474 8.380932-25.607902-3.738907-28.030515-56.790299-11.356705-105.233532-34.160427-139.233656-64.471315-33.930132-30.367333-53.245562-67.216792-53.245561-106.518217 0-27.359951 9.783022-53.611324 27.084499-77.566521a14.623733 14.623733 0 0 0 2.817728-8.365127v-142.999656l118.721594 63.536587c3.619244 1.971054 8.143864 2.291661 12.088231 0.889571 33.284403-9.868819 69.433946-14.890153 108.385412-14.890153 38.949208 0 75.096494 5.021334 108.385413 14.948856a15.36429 15.36429 0 0 0 12.146933-0.891829l118.662892-63.59529v142.91386a15.115932 15.115932 0 0 0 2.801922 8.42383c17.346633 23.925846 27.098046 50.235922 27.098047 77.564263 0 39.333033-19.268016 76.180235-53.200406 106.547568-34.043022 30.310888-82.5427 53.083-139.278811 64.471315-12.115324 2.363911-14.77049 22.42667-3.73665 27.971813 10.923209 5.723508 16.822825 15.240111 16.822825 25.23085v196.215867c-0.295771 9.28405 9.749156 17.281157 18.685505 14.948855C816.104564 903.343476 960.668872 726.517546 960.668872 516.285293c0-247.50392-201.00239-448.495021-448.492764-448.495021-247.50392 0-448.495021 200.991101-448.495021 448.495021z m448.495021-418.595052c231.37198 0 418.590537 187.236619 418.590537 418.595052 0 189.266376-126.779662 345.246091-298.995176 397.046664v-172.800282c0-11.970825-4.610416-22.60052-11.209949-31.769422 49.723403-13.666429 95.127645-35.156114 127.946942-64.471315 38.922115-34.600697 62.660564-78.952807 62.660564-128.005645 0-32.381285-11.794717-62.003545-29.897711-88.808078v-165.336015c0.085796-10.469392-13.314213-18.322-22.428928-13.068113l-137.34614 73.755365c-34.108498-9.254699-70.578648-15.840684-109.320139-15.840685-38.718913 0-75.277118 6.525025-109.322397 15.840685l-137.352913-73.726013c-9.094395-5.253887-22.510209 2.598721-22.424412 13.068113v165.336014c-18.116541 26.806791-29.899969 56.429051-29.899969 88.808079 0 49.025744 23.7678 93.375596 62.617665 127.978551 32.878 29.373903 78.32514 50.804886 127.962747 64.532275-6.572439 9.137293-11.185113 19.737637-11.185113 31.737813v50.482022c-32.584486 12.149191-54.015469 14.718561-67.275495 12.149191-14.291838-2.829016-21.999947-10.189425-30.787282-22.426671-17.70788-24.646082-35.083865-69.989364-92.546986-84.820814-19.547983-5.222278-26.161062 23.912299-7.475557 28.996852 45.081378 11.67957 53.972571 43.329329 75.638365 73.579256 10.889342 15.068519 26.497473 29.084905 49.578904 33.636619 19.227376 3.736649 42.498461 0.878282 72.863535-9.372104v90.600767c-172.156811-51.825409-298.995176-207.834475-298.995175-397.100851 0.009031-231.360691 187.24565-418.59731 418.604083-418.59731z" fill="#707070" p-id="9197"></path>
            </svg>  
        </a>
    

    
        <a href='#'>
            <svg t="1612751098681" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16516" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="16517"></path><path d="M792.845583 353.808158a119.106898 119.106898 0 0 0 8.717476-20.532369 17.083697 17.083697 0 0 0-24.939005-19.893726 192.646626 192.646626 0 0 1-52.560309 21.490333 122.332044 122.332044 0 0 0-81.810154-31.517026 121.980791 121.980791 0 0 0-121.789198 126.866409 281.673444 281.673444 0 0 1-183.130847-101.480355 17.115629 17.115629 0 0 0-27.972558 2.235251 121.757266 121.757266 0 0 0-2.107522 118.819508 20.053387 20.053387 0 0 0-6.833478 2.490707 18.233254 18.233254 0 0 0-8.430087 15.359362c0 36.242984 16.125733 69.516278 42.118499 92.124236l-1.117625 1.117625a17.051765 17.051765 0 0 0-3.448672 16.54085 121.853062 121.853062 0 0 0 69.739803 75.519521 195.871772 195.871772 0 0 1-108.760883 18.488712 17.403019 17.403019 0 0 0-18.073594 11.240115 17.115629 17.115629 0 0 0 6.865411 20.117251 314.244231 314.244231 0 0 0 169.847075 49.782212c197.340651 0 315.297992-160.299364 315.297992-315.266059l-0.031932-5.236872a227.420731 227.420731 0 0 0 49.207434-53.007359 17.083697 17.083697 0 0 0-20.787826-25.258326z m-55.721591 56.040913a17.083697 17.083697 0 0 0-7.088936 14.720718c0.191593 4.215043 0.287389 8.49395 0.287389 12.708994 0 138.20232-105.152551 281.16253-281.130598 281.162529a279.725583 279.725583 0 0 1-92.1881-15.582886 225.856056 225.856056 0 0 0 97.233379-44.385681 17.083697 17.083697 0 0 0-10.218286-30.495197 87.877261 87.877261 0 0 1-70.059124-37.105152c8.078832-0.542846 15.998004-1.883997 23.693651-3.959586a17.051765 17.051765 0 0 0-1.149558-33.20943 87.526007 87.526007 0 0 1-66.450792-60.830734c8.49395 2.139454 17.211426 3.384807 25.928901 3.672196 7.504054-0.031932 14.465261-4.630161 16.796308-11.846825s-0.415118-15.167768-6.769614-19.382812a87.685668 87.685668 0 0 1-36.498441-94.040164 315.585381 315.585381 0 0 0 209.730323 94.902332c5.620057 0.031932 10.537608-1.979793 13.954347-6.099039s4.725957-9.579643 3.512536-14.816515a87.813397 87.813397 0 0 1 149.506299-80.021954 17.083697 17.083697 0 0 0 15.774479 5.077211c5.268804-1.053761 10.473743-2.267182 15.614819-3.672196a81.043782 81.043782 0 0 1-7.216665 4.821753 17.083697 17.083697 0 0 0 10.793065 31.548959l5.81165-0.734439a178.979668 178.979668 0 0 1-9.867032 7.567918z" fill="#828282" p-id="16518"></path>
            </svg>
        </a>
    

    
        <a href='#' >
            <svg t="1612751005803" class="social-icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13371" width="22" height="22">
                <path d="M512.034307 0C229.72222 0 0.002375 229.655981 0.002375 512S229.72222 1024 512.034307 1024 1024.066239 794.344019 1024.066239 512 794.346394 0 512.034307 0z m0 989.89647C248.530253 989.89647 34.169769 775.504054 34.169769 512S248.530253 34.10353 512.034307 34.10353 989.898845 248.495946 989.898845 512 775.538361 989.89647 512.034307 989.89647z" fill="#828282" p-id="13372"></path><path d="M623.796812 224.610702h-85.194961C430.096425 223.525009 416.237875 290.678309 416.237875 363.355869V416.203567h-47.898217a14.209804 14.209804 0 0 0-15.966072 15.966073v95.796432a14.209804 14.209804 0 0 0 15.966072 15.966072H416.237875v239.491082a14.337533 14.337533 0 0 0 16.061868 15.966072h97.552701c9.419983 1.085693 17.051765-6.54609 14.050143-15.966072L543.966451 543.932144h79.830361a14.209804 14.209804 0 0 0 15.966072-15.966072v-95.796432a14.209804 14.209804 0 0 0-15.966072-15.966073h-79.926157L543.966451 368.305351c3.097418-20.40464 3.097418-17.083697 22.03318-15.966072h57.126606c4.438568-0.989896 9.164525-0.44705 12.485468-3.672197 3.320943-3.225147 5.236872-7.631782 4.119247-12.293875v-95.796433A14.177872 14.177872 0 0 0 623.796812 224.610702z m-17.083697 94.008233l-40.042909-1.532743c-49.59062 0-53.741799 26.918798-53.741799 54.476238l-0.127728 60.543345a17.051765 17.051765 0 0 0 17.051765 17.083697H607.83074v61.692903h-77.914432a17.083697 17.083697 0 0 0-17.083697 17.051765L512.800679 767.457154H448.170019v-239.491082c0-9.419983-6.418361-17.051765-15.870276-17.051765H384.30573v-61.692902h47.994013a17.051765 17.051765 0 0 0 12.070351-4.981415c3.193214-3.225147 3.767993-7.567918 3.767993-12.102283v-68.81377c0-71.591867 14.465261-105.695397 90.431832-105.695398h68.111263v60.990396z" fill="#828282" p-id="13373"></path>
            </svg>
        </a>
    

    

</div>
        
        
        <div>
            <script src="https://utteranc.es/client.js"
repo='vran-dev/vran-dev.github.io'
issue-term="pathname"
label="Comment"
theme="github-light"
crossorigin="anonymous"
async>

</script>
        </div>
        

    </section>

    <footer id="footer">
    <p>
        
        © 2022 <i></i> vran
        
        ∘ Powered by <a href="http://www.gohugo.io/">Hugo</a>  ∘  Theme <a href="https://github.com/vran-dev/hugo-zenHo">ZenHo</a>
    </p>
</footer>


<script>
    var token = 'bacd84bd97ed2e6eef56ec4cae65acdb';
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?" + token;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
